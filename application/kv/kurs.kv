#:include kv/cards.kv


MDScreenManager:
    id: main_screen_manager

    MDScreen:
        name: 'auth'

        Navigation:
            title: "АРМ \"Начальника производственного цеха предприятия\""

        MDFloatLayout:
            orientation: 'vertical'
            size_hint_y: 0.9
            spacing: 20
            padding: 20

            MDBoxLayout:
                orientation: 'vertical'
                adaptive_height: True
                spacing: 10
                size_hint: 0.5, None
                pos_hint: {"center_x": 0.5, "center_y": 0.5}

                MDBoxLayout:
                    adaptive_width: True
                    pos_hint: {"center_x": 0.5}
                    MDLabel:
                        text: "Авторизация"
                MDTextField:
                    id: login
                    size_hint:
                MDTextField:
                    id: password
                    password: True
                MDRectangleFlatButton:
                    text: "Войти"
                    on_press: app.auth(login.text, password.text)
                    pos_hint: {"center_x": 0.5}

    MDScreen:
        name: 'main'

        Navigation:
            title: "АРМ \"Начальника производственного цеха предприятия\""

        MDFloatLayout:
            size_hint_y: 0.9
            padding: 20

            MDBoxLayout:
                orientation: 'vertical'
                spacing: 20
                adaptive_height: True
                adaptive_width: True
                size_hint: None, None
                pos_hint: {"center_x": 0.5, "center_y": 0.5}

                MDRectangleFlatButton:
                    size_hint_x: 1
                    pos_hint: {"center_x": 0.5}
                    text: "Справочные документы"
                    on_press: main_screen_manager.current = 'tables'

                MDRectangleFlatButton:
                    size_hint_x: 1
                    pos_hint: {"center_x": 0.5}
                    text: "Оперативные документы"
                    on_press: main_screen_manager.current = 'operation_tables'

                MDRectangleFlatButton:
                    size_hint_x: 1
                    pos_hint: {"center_x": 0.5}
                    text: "Восстановление данных"
                    on_press: main_screen_manager.current = 'restore'

    MDScreen:
        name: 'tables'

        Navigation:
            title: "Справочные документы"

        MDNavigationLayout:
            MDScreenManager:
                id: table_screen_manager

                MDScreen:
                    name: 'table_choose'

                    MDFloatLayout:
                        size_hint_y: 0.9
                        padding: 20

                        MDBoxLayout:
                            orientation: 'vertical'
                            spacing: 20
                            adaptive_height: True
                            adaptive_width: True
                            size_hint: None, None
                            pos_hint: {"center_x": 0.5, "center_y": 0.5}

                            MDRectangleFlatButton:
                                size_hint_x: 1
                                pos_hint: {"center_x": 0.5}
                                text: "Список клиентов СПТ"
                                on_press: table_screen_manager.current = 'customer_view'; customer_list.refresh()

                            MDRectangleFlatButton:
                                size_hint_x: 1
                                pos_hint: {"center_x": 0.5}
                                text: "Справочник работников цеха"
                                on_press: table_screen_manager.current = 'worker_view'; worker_list.refresh()

                            MDRectangleFlatButton:
                                size_hint_x: 1
                                pos_hint: {"center_x": 0.5}
                                text: "Каталог работ"
                                on_press: table_screen_manager.current = 'work_view'; work_list.refresh()

                            MDRectangleFlatButton:
                                size_hint_x: 1
                                pos_hint: {"center_x": 0.5}
                                text: "Справочник СПТ"
                                on_press: table_screen_manager.current = 'spt_view'; spt_list.refresh()

                            MDRectangleFlatButton:
                                size_hint_x: 1
                                pos_hint: {"center_x": 0.5}
                                text: "Назад"
                                on_press: main_screen_manager.current = 'main'

                MDScreen:
                    name: 'customer_view'

                    Navigation:
                        title: "Список клиентов СПТ"

                    MDBoxLayout:
                        orientation: 'vertical'
                        size_hint_y: 0.9
                        spacing: 20
                        padding: 20

                        CustomerView:
                            id: customer_list

                        MDBoxLayout:
                            orientation: 'vertical'
                            size_hint_y: 0.1

                            TableBackButton:
                                screen_manager: table_screen_manager
                                back_screen: 'table_choose'

                MDScreen:
                    name: 'worker_view'

                    Navigation:
                        title: "Справочник работников цеха"

                    MDBoxLayout:
                        orientation: 'vertical'
                        size_hint_y: 0.9
                        spacing: 20
                        padding: 20

                        WorkerView:
                            id: worker_list

                        MDBoxLayout:
                            orientation: 'vertical'
                            size_hint_y: 0.1

                            TableBackButton:
                                screen_manager: table_screen_manager
                                back_screen: 'table_choose'

                MDScreen:
                    name: 'work_view'

                    Navigation:
                        title: "Каталог работ"

                    MDBoxLayout:
                        orientation: 'vertical'
                        size_hint_y: 0.9
                        spacing: 20
                        padding: 20

                        WorkView:
                            id: work_list

                        MDBoxLayout:
                            orientation: 'vertical'
                            size_hint_y: 0.1

                            TableBackButton:
                                screen_manager: table_screen_manager
                                back_screen: 'table_choose'

                MDScreen:
                    name: 'spt_view'

                    Navigation:
                        title: "Справочник СПТ"

                    MDBoxLayout:
                        orientation: 'vertical'
                        size_hint_y: 0.9
                        spacing: 20
                        padding: 20

                        SPTView:
                            id: spt_list

                        MDBoxLayout:
                            orientation: 'vertical'
                            size_hint_y: 0.1

                            TableBackButton:
                                screen_manager: table_screen_manager
                                back_screen: 'table_choose'

    MDScreen:
        name: 'operation_tables'

        Navigation:
            title: "Оперативные документы"

        MDNavigationLayout:
            MDScreenManager:
                id: operation_table_screen_manager

                MDScreen:
                    name: 'table_choose'

                    MDFloatLayout:
                        size_hint_y: 0.9
                        padding: 20

                        MDBoxLayout:
                            orientation: 'vertical'
                            spacing: 20
                            adaptive_height: True
                            adaptive_width: True
                            size_hint: None, None
                            pos_hint: {"center_x": 0.5, "center_y": 0.5}

                            MDRectangleFlatButton:
                                size_hint_x: 1
                                pos_hint: {"center_x": 0.5}
                                text: "Спецификация на выполнение работ"
                                on_press: operation_table_screen_manager.current = 'specification_view'; specification_list.refresh()

                            MDRectangleFlatButton:
                                size_hint_x: 1
                                pos_hint: {"center_x": 0.5}
                                text: "Наряд-задание"
                                on_press: operation_table_screen_manager.current = 'task_view'; task_list.refresh()

                            MDRectangleFlatButton:
                                size_hint_x: 1
                                pos_hint: {"center_x": 0.5}
                                text: "Назад"
                                on_press: main_screen_manager.current = 'main'

                MDScreen:
                    name: 'specification_view'

                    Navigation:
                        title: "Спецификация на выполнение работ"

                    MDBoxLayout:
                        orientation: 'vertical'
                        size_hint_y: 0.9
                        spacing: 20
                        padding: 20

                        SpecificationView:
                            id: specification_list

                        MDBoxLayout:
                            orientation: 'vertical'
                            size_hint_y: 0.1

                            TableBackButton:
                                screen_manager: operation_table_screen_manager
                                back_screen: 'table_choose'

                MDScreen:
                    name: 'task_view'

                    Navigation:
                        title: "Наряд-задание"

                    MDBoxLayout:
                        orientation: 'vertical'
                        size_hint_y: 0.9
                        spacing: 20
                        padding: 20

                        TaskView:
                            id: task_list

                        MDBoxLayout:
                            orientation: 'vertical'
                            size_hint_y: 0.1

                            TableBackButton:
                                screen_manager: operation_table_screen_manager
                                back_screen: 'table_choose'

    MDScreen:
        name: 'restore'

        Navigation:
            title: "Восстановление данных"

        MDBoxLayout:
            orientation: 'vertical'
            size_hint_y: 0.9
            spacing: 20
            padding: 20

            MDFloatLayout:
                size_hint_y: 0.9

                MDIconButton:
                    text: "Open manager"
                    icon: "folder"
                    pos_hint: {'center_x': .5, 'center_y': .5}
                    on_release: app.file_manager_open()

            MDBoxLayout:
                orientation: 'vertical'
                size_hint_y: 0.1

                TableBackButton:
                    screen_manager: main_screen_manager
                    back_screen: 'main'


<TableBackButton@MDRectangleFlatButton>:
    text: "Назад"
    size_hint_x: 0.2
    pos_hint: {"center_x": 0.5}
    on_press: self.screen_manager.current = self.back_screen


<Navigation>:
    pos_hint: {"top": 1}
    size_hint_y: 0.1
